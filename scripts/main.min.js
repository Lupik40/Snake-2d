import arrLang from"./lang.js";const gameStartBtns=document.querySelectorAll(".modal__btn_start"),gamePauseBtn=document.getElementById("btn-pause"),gameContinueBtns=document.querySelectorAll(".modal__btn_continue"),gameRestartBtns=document.querySelectorAll(".modal__btn_restart"),gameExitBtns=document.querySelectorAll(".modal__btn_exit"),gameSettingsBtns=document.querySelectorAll(".modal__btn_settings"),gameModeBtns=document.querySelectorAll(".modal__btn_gamemode"),gameModeChangeBtns=document.querySelectorAll(".modal__btn_mode"),gameAboutBtns=document.querySelectorAll(".modal__btn_about"),modals=document.querySelectorAll(".modal"),modalStart=document.getElementById("modal-start"),modalPause=document.getElementById("modal-pause"),modalGameOver=document.getElementById("modal-over"),modalSettings=document.getElementById("modal-settings"),modalGameMode=document.getElementById("modal-gamemode"),modalGameWin=document.getElementById("modal-win"),modalAbout=document.getElementById("modal-about"),radiosPlaceSize=document.querySelectorAll(".settings__radio_size"),radiosSpeed=document.querySelectorAll(".settings__radio_speed"),volumeInput=document.getElementById("settings-input-volume"),langInp=document.getElementById("lang-input"),volumeOutput=document.getElementById("volume-output"),stick=document.getElementById("joystick"),joystickTop=document.getElementById("joystick-top"),joystickRight=document.getElementById("joystick-right"),joystickDown=document.getElementById("joystick-down"),joystickLeft=document.getElementById("joystick-left"),eatSound=new Audio("/audio/eat-sound.mp3"),gameOverSound=new Audio("/audio/game-over.mp3"),backgroundSound=new Audio("/audio/background-sound.mp3"),gameWinSound=new Audio("/audio/new-record-sound.mp3");backgroundSound.loop=!0;const modalScores=document.querySelectorAll(".modal__score"),scoreBlock=document.getElementById("score-count"),maxScoreClassic=document.getElementById("max-results-classic"),maxScoreTimelimited=document.getElementById("max-results-timelimited"),timerWrapper=document.getElementById("timer"),timerCount=document.getElementById("timer-count"),transalateWords=document.querySelectorAll(".lang"),canvas=document.getElementById("game-canvas"),context=canvas.getContext("2d");let score=0,time=60,playGame=!1;const config={step:0,maxStep:6,sizeCell:16,sizeBerry:4},snake={x:160,y:160,dx:config.sizeCell,dy:0,tails:[],maxTails:3};let berry={x:0,y:0};const standartSettings={language:"en",gamePlace:"medium",speed:100,volume:.7,gameMode:"classic"};let gameSettings=JSON.parse(localStorage.getItem("settings"));gameSettings||(gameSettings=standartSettings);let maxScore=localStorage.getItem("maxScore"),maxScoreTime=localStorage.getItem("maxScoreTime");const renderSettings=()=>{maxScore||(maxScore=0),maxScoreTime||(maxScoreTime=0),"ua"==gameSettings.language?langInp.checked=!0:"en"==gameSettings.language&&(langInp.checked=!1),"classic"==gameSettings.gameMode?document.getElementById("modal-btn-classic").classList.add("toggle"):"timelimited"==gameSettings.gameMode&&document.getElementById("modal-btn-timelimited").classList.add("toggle"),volumeInput.value=100*gameSettings.volume,animationVolumeInp(),translate(),getVolume(),setPlaceSize(),setSpeedSnake(),drawScore()},translate=()=>{for(let e of transalateWords)e.innerHTML=arrLang[gameSettings.language][e.dataset.key]},getVolume=()=>{eatSound.volume=backgroundSound.volume=gameWinSound.volume=gameOverSound.volume=gameSettings.volume},setPlaceSize=()=>{"small"==gameSettings.gamePlace?(canvas.width=320,canvas.height=320,document.querySelector('input[data-size="small"]').checked=!0):"medium"==gameSettings.gamePlace?(canvas.width=400,canvas.height=400,document.querySelector('input[data-size="medium"]').checked=!0):"large"==gameSettings.gamePlace&&(canvas.width=480,canvas.height=480,document.querySelector('input[data-size="large"]').checked=!0)},setSpeedSnake=()=>{150==gameSettings.speed?document.querySelector('input[data-speed="150"]').checked=!0:100==gameSettings.speed?document.querySelector('input[data-speed="100"]').checked=!0:75==gameSettings.speed&&(document.querySelector('input[data-speed="75"]').checked=!0)},drawScore=()=>{scoreBlock.innerHTML=score,maxScoreClassic.innerHTML=maxScore,maxScoreTimelimited.innerHTML=maxScoreTime},changeSettings=()=>{localStorage.removeItem("settings"),localStorage.setItem("settings",JSON.stringify(gameSettings))},drawScoreInModal=()=>{for(let e of modalScores)e.innerHTML=score},closeModals=()=>{for(let e of modals)e.classList.remove("active")},playBackSound=()=>{playGame?backgroundSound.play():backgroundSound.pause()},volumeInputChange=()=>{gameSettings.volume=volumeInput.value/100,changeSettings(),getVolume(),animationVolumeInp()},animationVolumeInp=()=>{volumeInput.style.backgroundSize=100*(volumeInput.value-volumeInput.min)/(volumeInput.max-volumeInput.min)+"% 100%",volumeOutput.value=volumeInput.value},getRandomInt=(e,t)=>Math.floor(Math.random()*(t-e)+e),toggleStick=()=>{stick.classList.toggle("active")},refreshGame=()=>{score=0,drawScore(),snake.x=160,snake.y=160,snake.tails=[],snake.maxTails=3,snake.dx=config.sizeCell,snake.dy=0,randomPositionBerry()},refreshTimer=()=>{time=60,timerCount.innerHTML=time},timer=()=>{const e=setInterval(()=>{playGame?(--time<10&&(time=`0${time}`),time<1&&(gameToggle(),toggleStick(),modalGameWin.classList.add("active"),gameWinSound.play(),score>maxScoreTime&&(maxScoreTime=score,localStorage.setItem("maxScoreTime",maxScoreTime)),drawScoreInModal(),time=60,clearInterval(e))):clearInterval(e),timerCount.innerHTML=time},1e3)},gameToggle=()=>{playGame=!playGame,toggleStick(),playGame?backgroundSound.play():backgroundSound.pause()},startGame=()=>{"classic"==gameSettings.gameMode?(timerWrapper.classList.remove("active"),gameToggle()):"timelimited"==gameSettings.gameMode&&(timerWrapper.classList.add("active"),gameToggle(),timer())},gameLoop=()=>{setTimeout(()=>{requestAnimationFrame(()=>{playGame&&gameLoop()}),config.step=0,context.clearRect(0,0,canvas.width,canvas.height),drawBerry(),drawSnake()},gameSettings.speed)},drawSnake=()=>{snake.x+=snake.dx,snake.y+=snake.dy,collisionBorder(),snake.tails.unshift({x:snake.x,y:snake.y}),snake.tails.length>snake.maxTails&&snake.tails.pop(),snake.tails.forEach((e,t)=>{context.fillStyle=0==t?"#26B08F":"#27574C",context.fillRect(e.x,e.y,config.sizeCell,config.sizeCell),e.x===berry.x&&e.y===berry.y&&(eatSound.play(),snake.maxTails++,randomPositionBerry(),incScore());for(let a=t+1;a<snake.tails.length;a++)e.x==snake.tails[a].x&&e.y==snake.tails[a].y&&(gameToggle(),drawScoreInModal(),modalGameOver.classList.add("active"),gameOverSound.play())})},randomPositionBerry=()=>{berry.x=getRandomInt(0,canvas.width/config.sizeCell)*config.sizeCell,berry.y=getRandomInt(0,canvas.height/config.sizeCell)*config.sizeCell},drawBerry=()=>{context.beginPath(),context.fillstyle="#e51d5c",context.arc(berry.x+config.sizeCell/2,berry.y+config.sizeCell/2,config.sizeBerry,0,2*Math.PI),context.fill()},incScore=()=>{++score>maxScore&&"classic"==gameSettings.gameMode&&(gameWinSound.play(),maxScore=score,localStorage.setItem("maxScore",maxScore)),drawScore()},collisionBorder=()=>{snake.x<0?snake.x=canvas.width-config.sizeCell:snake.x>=canvas.width&&(snake.x=0),snake.y<0?snake.y=canvas.height-config.sizeCell:snake.y>=canvas.height&&(snake.y=0)},moveTop=()=>{snake.dy!=config.sizeCell&&(snake.dy=-config.sizeCell,snake.dx=0)},moveRight=()=>{snake.dx!=-config.sizeCell&&(snake.dx=config.sizeCell,snake.dy=0)},moveDown=()=>{snake.dy!=-config.sizeCell&&(snake.dy=config.sizeCell,snake.dx=0)},moveLeft=()=>{snake.dx!=config.sizeCell&&(snake.dx=-config.sizeCell,snake.dy=0)};document.addEventListener("keydown",e=>{let t=e.code;"KeyW"==t||"ArrowUp"==t?moveTop():"KeyA"==t||"ArrowLeft"==t?moveLeft():"KeyS"==t||"ArrowDown"==t?moveDown():"KeyD"!=t&&"ArrowRight"!=t||moveRight(),"Escape"!=t&&"Space"!=t||(!playGame&&modalPause.classList.contains("active")?(closeModals(),gameToggle(),requestAnimationFrame(gameLoop)):(gameToggle(),modalPause.classList.add("active")))}),joystickTop.addEventListener("click",moveTop),joystickRight.addEventListener("click",moveRight),joystickDown.addEventListener("click",moveDown),joystickLeft.addEventListener("click",moveLeft);for(let e of gameStartBtns)e.addEventListener("click",()=>{closeModals(),startGame(),requestAnimationFrame(gameLoop)});gamePauseBtn.addEventListener("click",()=>{playGame?(gameToggle(),modalPause.classList.add("active")):(gameToggle(),requestAnimationFrame(gameLoop))});for(let e of gameContinueBtns)e.addEventListener("click",()=>{closeModals(),gameToggle(),requestAnimationFrame(gameLoop),"timelimited"==gameSettings.gameMode&&timer()});for(let e of gameRestartBtns)e.addEventListener("click",()=>{refreshTimer(),closeModals(),startGame(),refreshGame(),requestAnimationFrame(gameLoop)});for(let e of gameExitBtns)e.addEventListener("click",()=>{closeModals(),modalStart.classList.add("active"),refreshTimer(),refreshGame()});for(let e of gameModeBtns)e.addEventListener("click",()=>{closeModals(),modalGameMode.classList.add("active")});for(let e of gameSettingsBtns)e.addEventListener("click",()=>{closeModals(),modalSettings.classList.add("active")});for(let e of gameAboutBtns)e.addEventListener("click",()=>{closeModals(),modalAbout.classList.add("active")});for(let e of gameModeChangeBtns)e.addEventListener("click",t=>{gameModeChangeBtns.forEach(e=>{e.classList.remove("toggle")}),e.classList.add("toggle"),gameSettings.gameMode=t.target.dataset.mode,changeSettings()});langInp.addEventListener("change",()=>{langInp.checked?gameSettings.language="ua":gameSettings.language="en",translate(),changeSettings()});for(let e of radiosPlaceSize)e.addEventListener("change",e=>{gameSettings.gamePlace=e.target.dataset.size,setPlaceSize(),changeSettings()});for(let e of radiosSpeed)e.addEventListener("change",e=>{gameSettings.speed=parseInt(e.target.dataset.speed),setSpeedSnake(),changeSettings()});volumeInput.addEventListener("input",volumeInputChange),maxScore||(maxScore=0),maxScoreTime||(maxScoreTime=0),"ua"==gameSettings.language?langInp.checked=!0:"en"==gameSettings.language&&(langInp.checked=!1),"classic"==gameSettings.gameMode?document.getElementById("modal-btn-classic").classList.add("toggle"):"timelimited"==gameSettings.gameMode&&document.getElementById("modal-btn-timelimited").classList.add("toggle"),volumeInput.value=100*gameSettings.volume,animationVolumeInp(),translate(),getVolume(),setPlaceSize(),setSpeedSnake(),drawScore();